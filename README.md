Команды установки приложения

k8s:

1. папка metrics
   В charts.yaml прописаны репозитории (prometheus, grafana, ingress-nginx, rabbitmq)
   1) sudo helm dependency update
   2) sudo helm install metrics .

2. папка auth
   В charts.yaml прописаны репозитории (postgresql)
   1) sudo helm dependency update
   2) sudo helm install auth .

3. папка billing
   В charts.yaml прописаны репозитории (postgresql)
   1) sudo helm dependency update
   2) sudo helm install billing .

4. папка order
   В charts.yaml прописаны репозитории (postgresql)
   1) sudo helm dependency update
   2) sudo helm install order .
  
5. папка delivery
   В charts.yaml прописаны репозитории (postgresql)
   1) sudo helm dependency update
   2) sudo helm install delivery .
      
6. папка warehouse
   В charts.yaml прописаны репозитории (postgresql)
   1) sudo helm dependency update
   2) sudo helm install warehouse .

7. Применить jobs для миграций:
   - sudo kubectl apply -f ./auth/job-auth.yaml
   - sudo kubectl apply -f ./auth/job-billing.yaml
   - sudo kubectl apply -f ./auth/job-order.yaml
   - sudo kubectl apply -f ./auth/job-delivery.yaml
   - sudo kubectl apply -f ./auth/job-warehouse.yaml
  

Описание того, какой паттерн для реализации распределенной транзакции использовался

Для решения был выбран паттерн "Saga" с реализацией "Оркестратор".

В качестве "Оркестратора" выступает сервис "order", который управляет шагами саги.

В качестве сервиса оплаты был выбран сервис "billing", который управляет "Кошельком" пользователя, который пополняется отдельно.

Сценарий:
1. Пользователь регистрируется
2. Пользователь авторизуется
3. У пользователя создается "Кошелек"
4. Пользователь пополняет кошелек
5. Создаются несколько товаров
6. Создается курьер
7. Пользователь выбирает из списка товары
8. Пользователь оформляет заказ
   Заказ принимает статус "Ожидание" и как только начинается сага, статус принимает статус "Ожидание оплаты"
9. Заказ сперва списывает деньги и принимает статус "Ожидание резервирования товаров"
   В случае неудачи, списание средств не происходит, заказ принимает статус "Отменен" и видно причину отмены (Не удалось списать средства)
   Сага не выполняется
10. Выполняется резервация товаров и заказ принимает статус "Ожидание резервирования курьера"
   В случае неудачи, резервация товаров не происходит, заказ принимает статус "Отменен" и видно причину отмены (Не удалось зарезервировать товары)
   Происходит "компенсационное действие" по возврату списанных средств.
   Сага не выполняется
11. Выполняется резервация курьера и заказ принимает статус "Готов"
   В случае неудачи, резервация курьера не происходит, заказ принимает статус "Отменен" и видно причину отмены (Не удалось зарезервировать курьера)
   Происходит "компенсационное действие" по возврату списанных средств
   Происходит "компенсационное действие" по отмену зарезервированных товаров
   Сага не выполняется

P.S. Товар считается зарезервированным кем-то, если у него quantity: 0, при создании товара quantity: 1
     У курьера есть availabilitySlot (массив). При резервации курьера в массив добавляется дата, на которую он зарезервирован. Если массив пустой или его пытаются зарезервировать на дату, которой нет в availabilitySlot, то он считается свободным

![Снимок экрана 2025-01-08 в 14 26 23](https://github.com/user-attachments/assets/e78bf3ba-16de-4d99-9ed8-7c22b024ff52)



